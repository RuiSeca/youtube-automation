
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <title>Settings - TechWealth Daily</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
    <div class="header">
        <button id="mobile-menu-btn" class="mobile-menu-btn">
            <i class="fas fa-bars"></i>
        </button>
        <h1><i class="fas fa-robot logo-icon"></i> TechWealth Daily</h1>
        <div class="nav-links" id="nav-links">
            <a href="/" class="nav-link">Dashboard</a>
            <a href="/videos" class="nav-link">Videos</a>
            <a href="/analytics" class="nav-link">Analytics</a>
            <a href="/settings" class="nav-link active">Settings</a>
        </div>
        <div class="theme-toggle d-flex align-center">
            <label class="theme-switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            <span class="slider"></span>
            </label>
            <span id="theme-label" class="ml-1">Dark Mode</span>
        </div>
    </div>

    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        <div class="alert-icon">
                            <i class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'error' %}exclamation-circle{% elif category == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-message">{{ message }}</div>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" data-tab="api-keys"><i class="fas fa-key mr-1"></i> API Keys</div>
                <div class="tab" data-tab="video-defaults"><i class="fas fa-video mr-1"></i> Video Defaults</div>
                <div class="tab" data-tab="youtube-settings"><i class="fab fa-youtube mr-1"></i> YouTube Settings</div>
                <div class="tab" data-tab="directories"><i class="fas fa-folder mr-1"></i> Directories</div>
                <div class="tab" data-tab="system"><i class="fas fa-cogs mr-1"></i> System</div>
            </div>
            
            <!-- API Keys Tab -->
            <div class="tab-content active" data-tab="api-keys">
                <div class="card">
                    <h2><i class="fas fa-key section-icon"></i> API Keys Configuration</h2>
                    <div class="alert alert-info mb-3">
                        <div class="alert-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="alert-content">
                            <div class="alert-message">API keys are required for content generation, voice synthesis, stock footage, and YouTube uploads. These keys are stored locally and never shared.</div>
                        </div>
                    </div>
                    
                    <form id="apiKeyForm" action="/settings/api-keys" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        <div class="form-group">
                            <label for="openai_api_key">
                                <i class="fas fa-brain mr-1"></i> OpenAI API Key
                                <span class="badge badge-info">For content generation</span>
                            </label>
                            <input type="password" id="openai_api_key" name="openai_api_key" class="form-control" value="{{ api_keys.openai or '' }}" placeholder="sk-...">
                            <div class="d-flex align-center gap-1 mt-1">
                                <button type="button" class="btn btn-sm btn-outline toggle-password" data-target="openai_api_key">
                                    <i class="fas fa-eye"></i> Show
                                </button>
                                <a href="https://platform.openai.com/api-keys" target="_blank" class="ml-1">
                                    <i class="fas fa-external-link-alt"></i> Get API Key
                                </a>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="elevenlabs_api_key">
                                <i class="fas fa-microphone mr-1"></i> ElevenLabs API Key
                                <span class="badge badge-info">For voice generation</span>
                            </label>
                            <input type="password" id="elevenlabs_api_key" name="elevenlabs_api_key" class="form-control" value="{{ api_keys.elevenlabs or '' }}" placeholder="Enter your ElevenLabs API key">
                            <div class="d-flex align-center gap-1 mt-1">
                                <button type="button" class="btn btn-sm btn-outline toggle-password" data-target="elevenlabs_api_key">
                                    <i class="fas fa-eye"></i> Show
                                </button>
                                <a href="https://elevenlabs.io/subscription" target="_blank" class="ml-1">
                                    <i class="fas fa-external-link-alt"></i> Get API Key
                                </a>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="pexels_api_key">
                                <i class="fas fa-images mr-1"></i> Pexels API Key
                                <span class="badge badge-info">For stock footage</span>
                            </label>
                            <input type="password" id="pexels_api_key" name="pexels_api_key" class="form-control" value="{{ api_keys.pexels or '' }}" placeholder="Enter your Pexels API key">
                            <div class="d-flex align-center gap-1 mt-1">
                                <button type="button" class="btn btn-sm btn-outline toggle-password" data-target="pexels_api_key">
                                    <i class="fas fa-eye"></i> Show
                                </button>
                                <a href="https://www.pexels.com/api/new/" target="_blank" class="ml-1">
                                    <i class="fas fa-external-link-alt"></i> Get API Key
                                </a>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="youtube_api_key">
                                <i class="fab fa-youtube mr-1"></i> YouTube API Key
                                <span class="badge badge-info">For YouTube integration</span>
                            </label>
                            <input type="password" id="youtube_api_key" name="youtube_api_key" class="form-control" value="{{ api_keys.youtube or '' }}" placeholder="Enter your YouTube API key">
                            <div class="d-flex align-center gap-1 mt-1">
                                <button type="button" class="btn btn-sm btn-outline toggle-password" data-target="youtube_api_key">
                                    <i class="fas fa-eye"></i> Show
                                </button>
                                <a href="https://console.cloud.google.com/apis/credentials" target="_blank" class="ml-1">
                                    <i class="fas fa-external-link-alt"></i> Get API Key
                                </a>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-end mt-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save API Keys
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Video Defaults Tab -->
            <div class="tab-content" data-tab="video-defaults">
                <div class="card">
                    <h2><i class="fas fa-video section-icon"></i> Video Default Settings</h2>
                    
                    <form id="videoDefaultsForm" action="/settings/video-defaults" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        <div class="form-group">
                            <label for="default_style">Default Content Style</label>
                            <select id="default_style" name="default_style" class="form-control">
                                <option value="informative" {% if video_defaults.style == 'informative' %}selected{% endif %}>Informative</option>
                                <option value="entertaining" {% if video_defaults.style == 'entertaining' %}selected{% endif %}>Entertaining</option>
                                <option value="educational" {% if video_defaults.style == 'educational' %}selected{% endif %}>Educational</option>
                                <option value="casual" {% if video_defaults.style == 'casual' %}selected{% endif %}>Casual/Conversational</option>
                                <option value="professional" {% if video_defaults.style == 'professional' %}selected{% endif %}>Professional</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="default_audience">Default Target Audience</label>
                            <select id="default_audience" name="default_audience" class="form-control">
                                <option value="general" {% if video_defaults.audience == 'general' %}selected{% endif %}>General</option>
                                <option value="beginners" {% if video_defaults.audience == 'beginners' %}selected{% endif %}>Beginners</option>
                                <option value="intermediate" {% if video_defaults.audience == 'intermediate' %}selected{% endif %}>Intermediate</option>
                                <option value="advanced" {% if video_defaults.audience == 'advanced' %}selected{% endif %}>Advanced</option>
                                <option value="professionals" {% if video_defaults.audience == 'professionals' %}selected{% endif %}>Professionals</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="default_video_length">Default Video Length</label>
                            <select id="default_video_length" name="default_video_length" class="form-control">
                                <option value="short" {% if video_defaults.video_length == 'short' %}selected{% endif %}>Short (2-3 minutes)</option>
                                <option value="medium" {% if video_defaults.video_length == 'medium' %}selected{% endif %}>Medium (5-7 minutes)</option>
                                <option value="long" {% if video_defaults.video_length == 'long' %}selected{% endif %}>Long (10-15 minutes)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="preferred_model">Preferred AI Model</label>
                            <select id="preferred_model" name="preferred_model" class="form-control">
                                <option value="gpt-3.5-turbo" {% if video_defaults.preferred_model == 'gpt-3.5-turbo' %}selected{% endif %}>GPT-3.5 Turbo (Faster, more economical)</option>
                                <option value="gpt-4" {% if video_defaults.preferred_model == 'gpt-4' %}selected{% endif %}>GPT-4 (More capable, higher quality)</option>
                                <option value="gpt-4o" {% if video_defaults.preferred_model == 'gpt-4o' %}selected{% endif %}>GPT-4o (Most advanced, highest quality)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Default Upload Settings</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="auto_upload" name="auto_upload" {% if video_defaults.auto_upload %}checked{% endif %}>
                                <label for="auto_upload">Automatically upload to YouTube when complete</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="auto_publish" name="auto_publish" {% if video_defaults.auto_publish %}checked{% endif %}>
                                <label for="auto_publish">Automatically publish (otherwise set as Private)</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="notify_subscribers" name="notify_subscribers" {% if video_defaults.notify_subscribers %}checked{% endif %}>
                                <label for="notify_subscribers">Notify subscribers of new videos</label>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-end mt-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Video Defaults
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- YouTube Settings Tab -->
            <div class="tab-content" data-tab="youtube-settings">
                <div class="card">
                    <h2><i class="fab fa-youtube section-icon"></i> YouTube Channel Settings</h2>
                    
                    {% if youtube_channel %}
                    <div class="alert alert-success mb-3">
                        <div class="alert-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="alert-content">
                            <div class="alert-title">Connected to YouTube</div>
                            <div class="alert-message">
                                Successfully connected to channel: <strong>{{ youtube_channel.title }}</strong><br>
                                Subscribers: {{ youtube_channel.subscribers }} | Videos: {{ youtube_channel.videos }}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="alert alert-warning mb-3">
                        <div class="alert-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="alert-content">
                            <div class="alert-title">YouTube Not Connected</div>
                            <div class="alert-message">Please complete the YouTube API setup to enable uploads.</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <form id="youtubeSettingsForm" action="/settings/youtube" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        <div class="form-group">
                            <label for="channel_keywords">Default Channel Keywords</label>
                            <input type="text" id="channel_keywords" name="channel_keywords" class="form-control" value="{{ youtube_settings.keywords or '' }}" placeholder="finance, investing, cryptocurrency, tech">
                            <small class="text-muted">Comma-separated keywords that describe your channel's content</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="default_category">Default Video Category</label>
                            <select id="default_category" name="default_category" class="form-control">
                                <option value="22" {% if youtube_settings.category == '22' %}selected{% endif %}>People & Blogs</option>
                                <option value="20" {% if youtube_settings.category == '20' %}selected{% endif %}>Gaming</option>
                                <option value="23" {% if youtube_settings.category == '23' %}selected{% endif %}>Comedy</option>
                                <option value="27" {% if youtube_settings.category == '27' %}selected{% endif %}>Education</option>
                                <option value="24" {% if youtube_settings.category == '24' %}selected{% endif %}>Entertainment</option>
                                <option value="10" {% if youtube_settings.category == '10' %}selected{% endif %}>Music</option>
                                <option value="25" {% if youtube_settings.category == '25' %}selected{% endif %}>News & Politics</option>
                                <option value="28" {% if youtube_settings.category == '28' %}selected{% endif %}>Science & Technology</option>
                                <option value="17" {% if youtube_settings.category == '17' %}selected{% endif %}>Sports</option>
                                <option value="26" {% if youtube_settings.category == '26' %}selected{% endif %}>Howto & Style</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="upload_schedule">Video Upload Schedule</label>
                            <div class="d-flex gap-2">
                                <select id="schedule_frequency" name="schedule_frequency" class="form-control">
                                    <option value="daily" {% if youtube_settings.frequency == 'daily' %}selected{% endif %}>Daily</option>
                                    <option value="weekly" {% if youtube_settings.frequency == 'weekly' %}selected{% endif %}>Weekly</option>
                                    <option value="biweekly" {% if youtube_settings.frequency == 'biweekly' %}selected{% endif %}>Twice a Week</option>
                                    <option value="monthly" {% if youtube_settings.frequency == 'monthly' %}selected{% endif %}>Monthly</option>
                                </select>
                                
                                <input type="time" id="schedule_time" name="schedule_time" class="form-control" value="{{ youtube_settings.time or '15:00' }}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>OAuth Authentication</label>
                            <div class="d-flex gap-2 align-center">
                                <button type="button" id="auth-youtube" class="btn btn-primary">
                                    <i class="fab fa-youtube"></i> {% if youtube_channel %}Reconnect{% else %}Connect{% endif %} to YouTube
                                </button>
                                
                                {% if youtube_channel %}
                                <button type="button" id="revoke-youtube" class="btn btn-outline">
                                    <i class="fas fa-unlink"></i> Disconnect
                                </button>
                                {% endif %}
                            </div>
                            <small class="text-muted mt-1 d-block">
                                This will open a browser window for YouTube authentication. You need to grant access to manage your videos.
                            </small>
                        </div>
                        
                        <div class="d-flex justify-end mt-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save YouTube Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Directories Tab -->
            <div class="tab-content" data-tab="directories">
                <div class="card">
                    <h2><i class="fas fa-folder section-icon"></i> Directory Settings</h2>
                    
                    <form id="directoriesForm" action="/settings/directories" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        {% for dir_name, dir_path in directories.items() %}
                        <div class="form-group">
                            <label for="dir_{{ dir_name }}">{{ dir_name|capitalize }} Directory</label>
                            <div class="d-flex gap-2">
                                <input type="text" id="dir_{{ dir_name }}" name="dir_{{ dir_name }}" class="form-control" value="{{ dir_path }}">
                                <button type="button" class="btn btn-outline directory-select" data-target="dir_{{ dir_name }}">
                                    <i class="fas fa-folder-open"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="create_missing" name="create_missing" checked>
                                <label for="create_missing">Create directories if missing</label>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-between mt-3">
                            <button type="button" id="reset-directories" class="btn btn-outline">
                                <i class="fas fa-undo"></i> Reset to Defaults
                            </button>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Directory Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- System Tab -->
            <div class="tab-content" data-tab="system">
                <div class="card">
                    <h2><i class="fas fa-cogs section-icon"></i> System Settings</h2>
                    
                    <form id="systemSettingsForm" action="/settings/system" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        <div class="form-group">
                            <label for="retry_attempts">API Retry Attempts</label>
                            <input type="number" id="retry_attempts" name="retry_attempts" class="form-control" value="{{ system_settings.retry_attempts or 3 }}" min="1" max="10">
                            <small class="text-muted">Number of times to retry API calls if they fail</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="use_api_quota">API vs. Template Usage</label>
                            <div class="d-flex gap-2 align-center">
                                <input type="range" id="use_api_quota" name="use_api_quota" class="form-control" value="{{ system_settings.use_api_quota * 100 or 80 }}" min="0" max="100" step="10">
                                <span id="api_quota_value">{{ system_settings.use_api_quota * 100 or 80 }}%</span>
                            </div>
                            <small class="text-muted">Percentage of content to generate using API (vs. templates)</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Cache Settings</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="cache_enabled" name="cache_enabled" {% if system_settings.cache_enabled %}checked{% endif %}>
                                <label for="cache_enabled">Enable content caching</label>
                            </div>
                            
                            <div class="d-flex gap-2 align-center mt-2">
                                <button type="button" id="clear-cache" class="btn btn-sm btn-outline">
                                    <i class="fas fa-trash"></i> Clear Cache
                                </button>
                                <small class="text-muted">Current cache size: <span id="cache-size">{{ cache_size or '0 KB' }}</span></small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Advanced Options</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="debug_mode" name="debug_mode" {% if system_settings.debug_mode %}checked{% endif %}>
                                <label for="debug_mode">Enable debug mode (verbose logging)</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="save_intermediates" name="save_intermediates" {% if system_settings.save_intermediates %}checked{% endif %}>
                                <label for="save_intermediates">Save intermediate files (scripts, audio, etc.)</label>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-between mt-3">
                            <button type="button" id="reset-all" class="btn btn-danger">
                                <i class="fas fa-exclamation-triangle"></i> Reset All Settings
                            </button>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save System Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div id="toast-container" class="toast-container"></div>
    
    <script src="/static/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle password visibility
            document.querySelectorAll('.toggle-password').forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const input = document.getElementById(targetId);
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        this.innerHTML = '<i class="fas fa-eye-slash"></i> Hide';
                    } else {
                        input.type = 'password';
                        this.innerHTML = '<i class="fas fa-eye"></i> Show';
                    }
                });
            });
            
            // API quota slider value display
            const apiQuotaSlider = document.getElementById('use_api_quota');
            const apiQuotaValue = document.getElementById('api_quota_value');
            
            if (apiQuotaSlider && apiQuotaValue) {
                apiQuotaSlider.addEventListener('input', function() {
                    apiQuotaValue.textContent = this.value + '%';
                });
            }
            
            // YouTube authentication
            const authYouTubeBtn = document.getElementById('auth-youtube');
            if (authYouTubeBtn) {
                authYouTubeBtn.addEventListener('click', function() {
                    window.open('/auth/youtube', '_blank', 'width=800,height=600');
                });
            }
            
            // YouTube revoke access
            const revokeYouTubeBtn = document.getElementById('revoke-youtube');
            if (revokeYouTubeBtn) {
                revokeYouTubeBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to disconnect from YouTube? This will revoke access and require re-authentication.')) {
                        fetch('/auth/youtube/revoke', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                showToast('success', 'Access Revoked', 'Successfully disconnected from YouTube.');
                                setTimeout(() => {
                                    window.location.reload();
                                }, 2000);
                            } else {
                                showToast('error', 'Error', data.message || 'Failed to disconnect from YouTube.');
                            }
                        });
                    }
                });
            }
            
            // Directory selector (would require backend implementation)
            document.querySelectorAll('.directory-select').forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    // This would normally open a directory selection dialog
                    // For now, we'll just show a toast message
                    showToast('info', 'Directory Selection', 'Directory selection dialog would appear here. Implementation requires backend support.');
                });
            });
            
            // Reset directories to defaults
            const resetDirectoriesBtn = document.getElementById('reset-directories');
            if (resetDirectoriesBtn) {
                resetDirectoriesBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to reset all directories to default values?')) {
                        fetch('/settings/directories/reset', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                showToast('success', 'Directories Reset', 'All directories have been reset to default values.');
                                setTimeout(() => {
                                    window.location.reload();
                                }, 2000);
                            } else {
                                showToast('error', 'Error', data.message || 'Failed to reset directories.');
                            }
                        });
                    }
                });
            }
            
            // Clear cache
            const clearCacheBtn = document.getElementById('clear-cache');
            if (clearCacheBtn) {
                clearCacheBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to clear the cache? This will remove all cached content.')) {
                        fetch('/settings/clear-cache', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                showToast('success', 'Cache Cleared', 'The cache has been successfully cleared.');
                                document.getElementById('cache-size').textContent = '0 KB';
                            } else {
                                showToast('error', 'Error', data.message || 'Failed to clear cache.');
                            }
                        });
                    }
                });
            }
            
            // Reset all settings
            const resetAllBtn = document.getElementById('reset-all');
            if (resetAllBtn) {
                resetAllBtn.addEventListener('click', function() {
                    if (confirm('WARNING: This will reset ALL settings to default values. API keys will be removed. This action cannot be undone. Are you sure?')) {
                        fetch('/settings/reset-all', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                showToast('success', 'Settings Reset', 'All settings have been reset to default values.');
                                setTimeout(() => {
                                    window.location.reload();
                                }, 2000);
                            } else {
                                showToast('error', 'Error', data.message || 'Failed to reset settings.');
                            }
                        });
                    }
                });
            }
            
            // Form submissions with AJAX
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const url = this.getAttribute('action');
                    
                    fetch(url, {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showToast('success', 'Settings Saved', data.message || 'Settings have been saved successfully.');
                        } else {
                            showToast('error', 'Error', data.message || 'There was an error saving the settings.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showToast('error', 'Submission Error', 'There was a problem with your submission.');
                    });
                });
            });
        });
        
    </script>
    
</body>
</html>
