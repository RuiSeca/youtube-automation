<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <title>Analytics - YouTube Shorts Automation</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/static/css/shorts_style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <style>
      /* Additional styles for the Analytics page */
      .chart-container {
        width: 100%;
        height: 300px;
        margin-bottom: 1.5rem;
      }

      .date-range-picker {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .date-input-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .range-presets {
        display: flex;
        gap: 0.5rem;
        margin-left: auto;
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .metric-card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow);
      }

      .metric-title {
        font-size: 0.9rem;
        color: #777;
        margin-bottom: 0.5rem;
      }

      [data-theme="dark"] .metric-title {
        color: #aaa;
      }

      .metric-value {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--primary-color);
      }

      .metric-change {
        display: flex;
        align-items: center;
        gap: 0.3rem;
        font-size: 0.8rem;
      }

      .metric-change.positive {
        color: var(--success-color);
      }

      .metric-change.negative {
        color: var(--danger-color);
      }

      .top-videos-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1.5rem;
      }

      .top-videos-table th,
      .top-videos-table td {
        padding: 0.8rem;
        border-bottom: 1px solid var(--border-color);
        text-align: left;
      }

      .top-videos-table th {
        font-weight: 500;
        color: #555;
        background-color: rgba(0, 0, 0, 0.03);
      }

      [data-theme="dark"] .top-videos-table th {
        color: #ddd;
        background-color: rgba(255, 255, 255, 0.05);
      }

      .top-videos-table tr:hover {
        background-color: rgba(0, 0, 0, 0.02);
      }

      [data-theme="dark"] .top-videos-table tr:hover {
        background-color: rgba(255, 255, 255, 0.02);
      }

      .video-title-cell {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .video-thumbnail-small {
        width: 80px;
        height: 140px;
        object-fit: cover;
        border-radius: 4px;
      }

      .video-title-small {
        font-weight: 500;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        max-width: 300px;
      }

      .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .kpi-card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: var(--shadow);
        text-align: center;
      }

      .kpi-icon {
        font-size: 2rem;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
      }

      .kpi-value {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.3rem;
      }

      .kpi-label {
        font-size: 0.9rem;
        color: #777;
      }

      [data-theme="dark"] .kpi-label {
        color: #aaa;
      }

      .insights-container {
        margin-top: 2rem;
      }

      .insight-card {
        display: flex;
        gap: 1rem;
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1.2rem;
        margin-bottom: 1rem;
        box-shadow: var(--shadow);
      }

      .insight-icon {
        font-size: 1.5rem;
        color: var(--primary-color);
        margin-top: 0.2rem;
      }

      .insight-content {
        flex-grow: 1;
      }

      .insight-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .insight-description {
        color: #666;
        line-height: 1.4;
      }

      [data-theme="dark"] .insight-description {
        color: #bbb;
      }

      .tab-container {
        margin-bottom: 2rem;
      }

      .tabs {
        display: flex;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 1.5rem;
      }

      .tab {
        padding: 0.8rem 1.5rem;
        cursor: pointer;
        position: relative;
        font-weight: 500;
      }

      .tab.active {
        color: var(--primary-color);
      }

      .tab.active:after {
        content: "";
        position: absolute;
        bottom: -1px;
        left: 0;
        right: 0;
        height: 3px;
        background-color: var(--primary-color);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      @media (max-width: 768px) {
        .date-range-picker {
          flex-direction: column;
          align-items: flex-start;
        }

        .range-presets {
          margin-left: 0;
          margin-top: 0.5rem;
        }

        .video-title-small {
          max-width: 200px;
        }
      }
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 28px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-label {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }

      .toggle-label:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .toggle-label {
        background-color: var(--primary-color);
      }

      input:checked + .toggle-label:before {
        transform: translateX(32px);
      }

      /* Added styling for data source toggle */
      .data-source-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
        background-color: #f5f5f5;
        padding: 8px 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      [data-theme="dark"] .data-source-toggle {
        background-color: #333;
      }

      #data-source-label.youtube-data {
        color: #FF0000;
        font-weight: bold;
      }

      .api-status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 5px;
      }

      .api-status-indicator.connected {
        background-color: #28a745;
      }

      .api-status-indicator.disconnected {
        background-color: #dc3545;
      }

      /* Loading overlay */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s;
      }

      .loading-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .loading-spinner {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      }

      .loading-spinner i {
        font-size: 40px;
        color: var(--primary-color);
        margin-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <button id="mobile-menu-btn" class="mobile-menu-btn">
        <i class="fas fa-bars"></i>
      </button>
      <h1>
        <i class="fab fa-youtube logo-icon"></i> YouTube Shorts Automation
      </h1>
      <div class="nav-links" id="nav-links">
        <a href="/" class="nav-link">Dashboard</a>
        <a href="/shorts" class="nav-link">My Shorts</a>
        <a href="/analytics" class="nav-link active">Analytics</a>
        <a href="/settings" class="nav-link">Settings</a>
      </div>
      <div class="theme-toggle d-flex align-center">
        <label class="theme-switch">
          <input type="checkbox" id="theme-toggle" />
          <span class="slider"></span>
        </label>
        <span id="theme-label" class="ml-1">Dark Mode</span>
      </div>
    </div>

    <div class="container">
      <div class="date-range-picker">
        <div class="date-input-group">
          <label for="start-date">From:</label>
          <input type="date" id="start-date" class="form-control" />
        </div>

        <div class="date-input-group">
          <label for="end-date">To:</label>
          <input type="date" id="end-date" class="form-control" />
        </div>

        <div class="range-presets">
          <button class="btn btn-sm btn-outline preset-btn" data-days="7">
            Last 7 days
          </button>
          <button class="btn btn-sm btn-outline preset-btn" data-days="30">
            Last 30 days
          </button>
          <button class="btn btn-sm btn-outline preset-btn" data-days="90">
            Last 90 days
          </button>
        </div>

        <button id="update-analytics" class="btn btn-primary">
          <i class="fas fa-sync-alt"></i> Update
        </button>
      </div>

      <!-- Enhanced data source toggle with status indicator -->
      <div class="data-source-toggle">
        <span>Data Source:</span>
        <div class="toggle-switch">
          <input type="checkbox" id="data-source-toggle" />
          <label for="data-source-toggle" class="toggle-label"></label>
        </div>
        <span id="data-source-label">Sample Data</span>
        <div id="api-connection-status" class="ml-2"></div>
      </div>

      <div class="tab-container">
        <div class="tabs">
          <div class="tab active" data-tab="overview">Overview</div>
          <div class="tab" data-tab="engagement">Engagement</div>
          <div class="tab" data-tab="audience">Audience</div>
          <div class="tab" data-tab="performance">Performance Tracking</div>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content active" id="overview-tab">
          <div class="kpi-grid">
            <div class="kpi-card">
              <div class="kpi-icon"><i class="fas fa-eye"></i></div>
              <div class="kpi-value" id="total-views">0</div>
              <div class="kpi-label">Total Views</div>
            </div>

            <div class="kpi-card">
              <div class="kpi-icon"><i class="fas fa-thumbs-up"></i></div>
              <div class="kpi-value" id="total-likes">0</div>
              <div class="kpi-label">Total Likes</div>
            </div>

            <div class="kpi-card">
              <div class="kpi-icon"><i class="fas fa-comments"></i></div>
              <div class="kpi-value" id="total-comments">0</div>
              <div class="kpi-label">Total Comments</div>
            </div>

            <div class="kpi-card">
              <div class="kpi-icon"><i class="fas fa-share"></i></div>
              <div class="kpi-value" id="total-shares">0</div>
              <div class="kpi-label">Total Shares</div>
            </div>

            <div class="kpi-card">
              <div class="kpi-icon"><i class="fas fa-users"></i></div>
              <div class="kpi-value" id="new-subscribers">0</div>
              <div class="kpi-label">New Subscribers</div>
            </div>

            <div class="kpi-card">
              <div class="kpi-icon"><i class="fas fa-clock"></i></div>
              <div class="kpi-value" id="watch-time">0</div>
              <div class="kpi-label">Watch Time (hours)</div>
            </div>
          </div>

          <div class="card">
            <h2>
              <i class="fas fa-chart-line section-icon"></i> Views Over Time
            </h2>
            <div class="chart-container" id="views-chart">
              <!-- Chart will be rendered here -->
              <div class="empty-state">
                <i class="fas fa-chart-line"></i>
                <p>Loading chart data...</p>
              </div>
            </div>
          </div>

          <div class="card">
            <h2>
              <i class="fas fa-trophy section-icon"></i> Top Performing Shorts
            </h2>
            <div class="table-responsive">
              <table class="top-videos-table">
                <thead>
                  <tr>
                    <th>Video</th>
                    <th>Published</th>
                    <th>Views</th>
                    <th>Likes</th>
                    <th>Comments</th>
                    <th>CTR</th>
                  </tr>
                </thead>
                <tbody id="top-videos-body">
                  <!-- Table rows will be added dynamically -->
                  <tr>
                    <td colspan="6">
                      <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading top videos data...</p>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="insights-container">
            <h2><i class="fas fa-lightbulb section-icon"></i> Insights</h2>
            <div id="insights-container">
              <!-- Insights will be added dynamically -->
              <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Analyzing your data for insights...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Engagement Tab -->
        <div class="tab-content" id="engagement-tab">
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-title">Average Watch Time</div>
              <div class="metric-value" id="avg-watch-time">0:00</div>
              <div class="metric-change positive">
                <i class="fas fa-caret-up"></i> 3.2% vs previous period
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-title">Average Engagement Rate</div>
              <div class="metric-value" id="engagement-rate">0%</div>
              <div class="metric-change positive">
                <i class="fas fa-caret-up"></i> 5.7% vs previous period
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-title">Like to View Ratio</div>
              <div class="metric-value" id="like-view-ratio">0%</div>
              <div class="metric-change negative">
                <i class="fas fa-caret-down"></i> 1.4% vs previous period
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-title">Comment to View Ratio</div>
              <div class="metric-value" id="comment-view-ratio">0%</div>
              <div class="metric-change positive">
                <i class="fas fa-caret-up"></i> 2.1% vs previous period
              </div>
            </div>
          </div>

          <div class="card">
            <h2>
              <i class="fas fa-chart-bar section-icon"></i> Engagement Metrics
            </h2>
            <div class="chart-container" id="engagement-chart">
              <!-- Chart will be rendered here -->
              <div class="empty-state">
                <i class="fas fa-chart-bar"></i>
                <p>Loading engagement data...</p>
              </div>
            </div>
          </div>

          <div class="card">
            <h2>
              <i class="fas fa-chart-pie section-icon"></i> Engagement Sources
            </h2>
            <div class="chart-container" id="sources-chart">
              <!-- Chart will be rendered here -->
              <div class="empty-state">
                <i class="fas fa-chart-pie"></i>
                <p>Loading source data...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Audience Tab -->
        <div class="tab-content" id="audience-tab">
          <div class="card">
            <h2>
              <i class="fas fa-users section-icon"></i> Audience Demographics
            </h2>

            <div class="chart-container" id="demographics-chart">
              <!-- Chart will be rendered here -->
              <div class="empty-state">
                <i class="fas fa-users"></i>
                <p>Loading demographic data...</p>
              </div>
            </div>
          </div>

          <div class="card">
            <h2>
              <i class="fas fa-globe section-icon"></i> Geographic Distribution
            </h2>
            <div class="chart-container" id="geography-chart">
              <!-- Chart will be rendered here -->
              <div class="empty-state">
                <i class="fas fa-globe"></i>
                <p>Loading geography data...</p>
              </div>
            </div>
          </div>

          <div class="card">
            <h2>
              <i class="fas fa-mobile-alt section-icon"></i> Device & Platform
            </h2>
            <div class="chart-container" id="device-chart">
              <!-- Chart will be rendered here -->
              <div class="empty-state">
                <i class="fas fa-mobile-alt"></i>
                <p>Loading device data...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Tab -->
        <div class="tab-content" id="performance-tab">
          <div class="card">
            <h2>
              <i class="fas fa-tachometer-alt section-icon"></i> Shorts
              Performance Tracking
            </h2>
            <div class="chart-container" id="performance-chart">
              <!-- Chart will be rendered here -->
              <div class="empty-state">
                <i class="fas fa-tachometer-alt"></i>
                <p>Loading performance data...</p>
              </div>
            </div>
          </div>

          <div class="card">
            <h2>
              <i class="fas fa-tags section-icon"></i> Top Performing Topics
            </h2>
            <div class="chart-container" id="topics-chart">
              <!-- Chart will be rendered here -->
              <div class="empty-state">
                <i class="fas fa-tags"></i>
                <p>Loading topic performance data...</p>
              </div>
            </div>
          </div>

          <div class="card">
            <h2>
              <i class="fas fa-calendar-alt section-icon"></i> Best Publishing
              Times
            </h2>
            <div class="chart-container" id="publishing-chart">
              <!-- Chart will be rendered here -->
              <div class="empty-state">
                <i class="fas fa-calendar-alt"></i>
                <p>Analyzing best publishing times...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p id="loading-message">Loading data...</p>
      </div>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // Global variables for easier access
        const dataSourceToggle = document.getElementById("data-source-toggle");
        const dataSourceLabel = document.getElementById("data-source-label");
        const apiConnectionStatus = document.getElementById("api-connection-status");
        const loadingOverlay = document.getElementById("loading-overlay");
        const loadingMessage = document.getElementById("loading-message");

        // Check YouTube auth status on page load
        checkYouTubeConnection();

        // Set default date range (last 30 days)
        const endDate = new Date();
        const startDate = new Date();
        startDate.setDate(startDate.getDate() - 30);

        document.getElementById("end-date").valueAsDate = endDate;
        document.getElementById("start-date").valueAsDate = startDate;

        // Initialize toggle state from localStorage
        const useRealData = localStorage.getItem("useRealData") === "true";
        dataSourceToggle.checked = useRealData;
        updateDataSourceLabel(useRealData);

        // ====== LOADING AND OVERLAY FUNCTIONS ======
        function showLoading(message = "Loading data...") {
          loadingMessage.textContent = message;
          loadingOverlay.classList.add("active");
        }

        function hideLoading() {
          loadingOverlay.classList.remove("active");
        }

        // ====== DATA SOURCE TOGGLE ======
        dataSourceToggle.addEventListener("change", function() {
          const useRealData = this.checked;
          console.log("Toggle changed, new state:", useRealData);
          
          localStorage.setItem("useRealData", useRealData);
          updateDataSourceLabel(useRealData);

          // First, check if YouTube channel is connected if trying to use real data
          if (useRealData) {
            showLoading("Verifying YouTube connection...");
            
            fetch("/api/youtube/channel")
              .then(response => response.json())
              .then(data => {
                if (!data.success) {
                  // YouTube not connected, show error and revert toggle
                  hideLoading();
                  showToast("error", "YouTube Not Connected", 
                    "Please connect your YouTube channel in Settings before using YouTube data.");
                  dataSourceToggle.checked = false;
                  localStorage.setItem("useRealData", "false");
                  updateDataSourceLabel(false);
                } else {
                  // YouTube connected, proceed with real data
                  showLoading("Loading YouTube analytics data...");
                  loadAllData(true);
                }
              })
              .catch(error => {
                console.error("Error checking YouTube connection:", error);
                hideLoading();
                dataSourceToggle.checked = false;
                localStorage.setItem("useRealData", "false");
                updateDataSourceLabel(false);
                showToast("error", "Connection Error", "Could not verify YouTube connection.");
              });
          } else {
            // Switching to sample data
            showLoading("Loading sample data...");
            loadAllData(false);
          }
        });

        function updateDataSourceLabel(useRealData) {
          if (useRealData) {
            dataSourceLabel.textContent = "YouTube API";
            dataSourceLabel.classList.add("youtube-data");
          } else {
            dataSourceLabel.textContent = "Sample Data";
            dataSourceLabel.classList.remove("youtube-data");
          }
        }

        // ====== CHECK YOUTUBE CONNECTION ======
        function checkYouTubeConnection() {
          fetch("/api/youtube/channel")
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                // Connected
                apiConnectionStatus.innerHTML = `
                  <span class="api-status-indicator connected"></span>
                  <span class="text-success">Connected as ${data.channel.title}</span>
                `;
              } else {
                // Not connected
                apiConnectionStatus.innerHTML = `
                  <span class="api-status-indicator disconnected"></span>
                  <span class="text-danger">Not connected</span>
                `;
                
                // Disable YouTube API toggle if not connected
                dataSourceToggle.checked = false;
                localStorage.setItem("useRealData", "false");
                updateDataSourceLabel(false);
                dataSourceToggle.disabled = true;
                showToast("warning", "YouTube API Unavailable", 
                  "Please connect your YouTube channel in Settings to use YouTube data.");
              }
            })
            .catch(error => {
              console.error("Error checking YouTube connection:", error);
              apiConnectionStatus.innerHTML = `
                <span class="api-status-indicator disconnected"></span>
                <span class="text-danger">Error checking connection</span>
              `;
              
              // Disable YouTube API toggle on error
              dataSourceToggle.checked = false;
              localStorage.setItem("useRealData", "false");
              updateDataSourceLabel(false);
            });
        }

        // ====== TAB SWITCHING ======
        const tabs = document.querySelectorAll(".tab");
        const tabContents = document.querySelectorAll(".tab-content");

        tabs.forEach((tab) => {
          tab.addEventListener("click", function() {
            const tabId = this.getAttribute("data-tab");

            // Remove active class from all tabs and contents
            tabs.forEach((t) => t.classList.remove("active"));
            tabContents.forEach((c) => c.classList.remove("active"));

            // Add active class to clicked tab and corresponding content
            this.classList.add("active");
            document.getElementById(`${tabId}-tab`).classList.add("active");

            // Load data for the tab if needed
            loadTabData(tabId);
          });
        });

        // ====== DATE RANGE PRESETS ======
        document.querySelectorAll(".preset-btn").forEach((btn) => {
          btn.addEventListener("click", function() {
            const days = parseInt(this.getAttribute("data-days"));
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - days);

            document.getElementById("end-date").valueAsDate = endDate;
            document.getElementById("start-date").valueAsDate = startDate;

            // Highlight active preset
            document.querySelectorAll(".preset-btn").forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
          });
        });

        // ====== UPDATE BUTTON ======
        document.getElementById("update-analytics").addEventListener("click", function() {
          const useRealData = localStorage.getItem("useRealData") === "true";
          showLoading(useRealData ? "Updating YouTube analytics data..." : "Updating sample data...");
          loadAllData(useRealData);
        });

        // ====== DATA LOADING FUNCTIONS ======
        function loadAllData(useRealData = localStorage.getItem("useRealData") === "true") {
          console.log(`Loading all data with useRealData = ${useRealData}`);
          
          loadOverviewData(useRealData);
          loadEngagementData(useRealData);
          loadAudienceData(useRealData);
          loadPerformanceData(useRealData);
          
          setTimeout(() => hideLoading(), 1000);
        }

        function loadTabData(tabId, useRealData = localStorage.getItem("useRealData") === "true") {
          console.log(`Loading tab data for ${tabId} with useRealData = ${useRealData}`);
          
          showLoading(`Loading ${tabId} data...`);
          
          switch (tabId) {
            case "overview":
              loadOverviewData(useRealData);
              break;
            case "engagement":
              loadEngagementData(useRealData);
              break;
            case "audience":
              loadAudienceData(useRealData);
              break;
            case "performance":
              loadPerformanceData(useRealData);
              break;
          }
          
          setTimeout(() => hideLoading(), 1000);
        }

        // ====== LOAD OVERVIEW DATA ======
        function loadOverviewData(useRealData = localStorage.getItem("useRealData") === "true") {
          console.log(`Loading overview data with useRealData = ${useRealData}`);
          
          const startDate = document.getElementById("start-date").value;
          const endDate = document.getElementById("end-date").value;
          
          // Show loading states
          document.getElementById("views-chart").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading chart data...</p>
            </div>
          `;

          document.getElementById("top-videos-body").innerHTML = `
            <tr>
                <td colspan="6">
                    <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading top videos data...</p>
                    </div>
                </td>
            </tr>
          `;

          document.getElementById("insights-container").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Analyzing your data for insights...</p>
            </div>
          `;

          if (useRealData) {
            console.log("Fetching REAL YouTube data...");
            // Create a URL with the parameters
            const apiUrl = `/api/analytics?start_date=${startDate}&end_date=${endDate}&use_real_data=true`;
            console.log("API URL:", apiUrl);
            
            // Fetch real data from YouTube API
            fetch(apiUrl)
              .then(response => response.json())
              .then(data => {
                console.log("YouTube API Response received:", data);
                
                if (data.success) {
                  // Update KPIs with real data
                  document.getElementById("total-views").textContent = formatNumber(data.summary.total_views || 0);
                  document.getElementById("total-likes").textContent = formatNumber(data.summary.total_likes || 0);
                  document.getElementById("total-comments").textContent = formatNumber(data.summary.total_comments || 0);
                  document.getElementById("total-shares").textContent = formatNumber(data.summary.total_shares || 0);
                  document.getElementById("new-subscribers").textContent = formatNumber(data.summary.new_subscribers || 0);
                  document.getElementById("watch-time").textContent = formatNumber(data.summary.watch_time || 0);

                  // Create charts with real data
                  createViewsChartWithData(data.views_data);
                  createTopVideosTableWithData(data.top_videos);
                  createInsightsWithData(data.insights || []);
                  
                  showToast("success", "YouTube Data Loaded", "Successfully loaded YouTube Analytics data.");
                } else {
                  console.error("YouTube API Error:", data.message);
                  showToast("error", "YouTube API Error", 
                           data.message || "Failed to fetch YouTube analytics data.");
                  
                  // Show the error in charts
                  document.getElementById("views-chart").innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i>
                        <p>Error loading YouTube data: ${data.message || "Unknown error"}</p>
                        <button id="retry-youtube-btn" class="btn btn-sm btn-primary mt-2">Retry</button>
                        <button id="use-sample-btn" class="btn btn-sm btn-outline mt-2">Use Sample Data</button>
                    </div>
                  `;
                  
                  // Add event listeners to the buttons
                  document.getElementById("retry-youtube-btn")?.addEventListener("click", () => {
                    loadOverviewData(true);
                  });
                  
                  document.getElementById("use-sample-btn")?.addEventListener("click", () => {
                    dataSourceToggle.checked = false;
                    localStorage.setItem("useRealData", "false");
                    updateDataSourceLabel(false);
                    loadOverviewData(false);
                  });
                }
                
                hideLoading();
              })
              .catch(error => {
                console.error("Error fetching real data:", error);
                hideLoading();
                showToast("error", "Connection Error", "Failed to connect to the analytics API.");
                
                // Switch to sample data
                dataSourceToggle.checked = false;
                localStorage.setItem("useRealData", "false");
                updateDataSourceLabel(false);
                loadSampleData();
              });
          } else {
            console.log("Using sample data as requested");
            loadSampleData();
          }
        }

        // Helper function to load sample data
        function loadSampleData() {
          console.log("Loading sample data...");
          
          // Update KPIs with sample data
          document.getElementById("total-views").textContent = "15,743";
          document.getElementById("total-likes").textContent = "2,891";
          document.getElementById("total-comments").textContent = "584";
          document.getElementById("total-shares").textContent = "326";
          document.getElementById("new-subscribers").textContent = "147";
          document.getElementById("watch-time").textContent = "329";

          // Create charts with sample data
          createViewsChart();
          createTopVideosTable();
          createInsights();
          
          hideLoading();
        }

        // ====== LOAD ENGAGEMENT DATA ======
        function loadEngagementData(useRealData = localStorage.getItem("useRealData") === "true") {
          console.log(`Loading engagement data with useRealData = ${useRealData}`);
          
          // Simulate loading states
          document.getElementById("engagement-chart").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading engagement data...</p>
            </div>
          `;

          document.getElementById("sources-chart").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading source data...</p>
            </div>
          `;

          if (useRealData) {
            const startDate = document.getElementById("start-date").value;
            const endDate = document.getElementById("end-date").value;
            
            fetch(`/api/analytics?start_date=${startDate}&end_date=${endDate}&use_real_data=true`)
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  // Update metrics with real data if available
                  if (data.engagement_data) {
                    // Update metrics
                    document.getElementById("avg-watch-time").textContent = formatTime(data.summary.watch_time / data.summary.total_views * 60) || "0:00";
                    document.getElementById("engagement-rate").textContent = calculateEngagementRate(data) + "%";
                    document.getElementById("like-view-ratio").textContent = (data.summary.total_likes / data.summary.total_views * 100).toFixed(1) + "%";
                    document.getElementById("comment-view-ratio").textContent = (data.summary.total_comments / data.summary.total_views * 100).toFixed(1) + "%";
                    
                    // Create charts
                    createEngagementChartWithData(data.engagement_data);
                    createSourcesChartWithData(data.device_data);
                  } else {
                    // If missing engagement data, use sample data
                    useEngagementSampleData();
                  }
                } else {
                  console.error("YouTube API Error:", data.message);
                  useEngagementSampleData();
                }
              })
              .catch(error => {
                console.error("Error fetching engagement data:", error);
                useEngagementSampleData();
              });
          } else {
            useEngagementSampleData();
          }
        }

        function useEngagementSampleData() {
          // Update metrics
          document.getElementById("avg-watch-time").textContent = "0:23";
          document.getElementById("engagement-rate").textContent = "7.8%";
          document.getElementById("like-view-ratio").textContent = "18.4%";
          document.getElementById("comment-view-ratio").textContent = "3.7%";

          // Create charts with sample data
          createEngagementChart();
          createSourcesChart();
        }

        function calculateEngagementRate(data) {
          // Calculate engagement rate: (likes + comments + shares) / views * 100
          const totalEngagements = data.summary.total_likes + data.summary.total_comments + data.summary.total_shares;
          return (totalEngagements / data.summary.total_views * 100).toFixed(1);
        }

        // ====== LOAD AUDIENCE DATA ======
        function loadAudienceData(useRealData = localStorage.getItem("useRealData") === "true") {
          console.log(`Loading audience data with useRealData = ${useRealData}`);
          
          // Show loading states
          document.getElementById("demographics-chart").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading demographic data...</p>
            </div>
          `;

          document.getElementById("geography-chart").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading geography data...</p>
            </div>
          `;

          document.getElementById("device-chart").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading device data...</p>
            </div>
          `;

          if (useRealData) {
            const startDate = document.getElementById("start-date").value;
            const endDate = document.getElementById("end-date").value;
            
            fetch(`/api/analytics?start_date=${startDate}&end_date=${endDate}&use_real_data=true`)
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  // Create charts with real data if available
                  if (data.demographics_data && data.geographic_data && data.device_data) {
                    createDemographicsChartWithData(data.demographics_data);
                    createGeographyChartWithData(data.geographic_data);
                    createDeviceChartWithData(data.device_data);
                  } else {
                    // If missing audience data, use sample data
                    useAudienceSampleData();
                  }
                } else {
                  console.error("YouTube API Error:", data.message);
                  useAudienceSampleData();
                }
              })
              .catch(error => {
                console.error("Error fetching audience data:", error);
                useAudienceSampleData();
              });
          } else {
            useAudienceSampleData();
          }
        }

        function useAudienceSampleData() {
          // Create audience charts with sample data
          createDemographicsChart();
          createGeographyChart();
          createDeviceChart();
        }

        // ====== LOAD PERFORMANCE DATA ======
        function loadPerformanceData(useRealData = localStorage.getItem("useRealData") === "true") {
          console.log(`Loading performance data with useRealData = ${useRealData}`);
          
          // Show loading states
          document.getElementById("performance-chart").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading performance data...</p>
            </div>
          `;

          document.getElementById("topics-chart").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading topic performance data...</p>
            </div>
          `;

          document.getElementById("publishing-chart").innerHTML = `
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Analyzing best publishing times...</p>
            </div>
          `;

          if (useRealData) {
            const startDate = document.getElementById("start-date").value;
            const endDate = document.getElementById("end-date").value;
            
            fetch(`/api/analytics?start_date=${startDate}&end_date=${endDate}&use_real_data=true`)
              .then(response => response.json())
              .then(data => {
                if (data.success && data.performance_data) {
                  // Create charts with real data
                  createPerformanceChartWithData(data.performance_data);
                  
                  // These might not be available from the API, use sample data
                  createTopicsChart();
                  createPublishingChart();
                } else {
                  console.error("YouTube API Error or missing performance data");
                  usePerformanceSampleData();
                }
              })
              .catch(error => {
                console.error("Error fetching performance data:", error);
                usePerformanceSampleData();
              });
          } else {
            usePerformanceSampleData();
          }
        }

        function usePerformanceSampleData() {
          // Create performance charts with sample data
          createPerformanceChart();
          createTopicsChart();
          createPublishingChart();
        }

        // ====== CHART CREATION FUNCTIONS ======
        
        // Views Chart - Sample Data
        function createViewsChart() {
          const ctx = document.createElement("canvas");
          document.getElementById("views-chart").innerHTML = "";
          document.getElementById("views-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "line",
            data: {
              labels: [
                "Mar 1",
                "Mar 5",
                "Mar 10",
                "Mar 15",
                "Mar 20",
                "Mar 25",
                "Mar 30",
              ],
              datasets: [
                {
                  label: "Views",
                  data: [1205, 1845, 2398, 3120, 3987, 4532, 5120],
                  borderColor: "#FF0000",
                  backgroundColor: "rgba(255, 0, 0, 0.1)",
                  fill: true,
                  tension: 0.3,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
                tooltip: {
                  mode: "index",
                  intersect: false,
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      if (value >= 1000) {
                        return value / 1000 + "k";
                      }
                      return value;
                    },
                  },
                },
              },
            },
          });
        }

        // Views Chart - Real Data
        function createViewsChartWithData(viewsData) {
          if (!viewsData || !viewsData.length) {
            console.log("No views data available");
            createViewsChart(); // Fall back to sample data
            return;
          }

          const ctx = document.createElement("canvas");
          document.getElementById("views-chart").innerHTML = "";
          document.getElementById("views-chart").appendChild(ctx);

          // Extract dates and views from the data
          const labels = viewsData.map(item => item.date);
          const views = viewsData.map(item => item.views);

          new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Views",
                  data: views,
                  borderColor: "#FF0000",
                  backgroundColor: "rgba(255, 0, 0, 0.1)",
                  fill: true,
                  tension: 0.3,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
                tooltip: {
                  mode: "index",
                  intersect: false,
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      if (value >= 1000) {
                        return value / 1000 + "k";
                      }
                      return value;
                    },
                  },
                },
              },
            },
          });
        }
        
        // Top Videos Table - Sample Data
        function createTopVideosTable() {
          document.getElementById("top-videos-body").innerHTML = `
            <tr>
                <td>
                    <div class="video-title-cell">
                        <img src="/static/images/placeholder_vertical.jpg" alt="Video 1" class="video-thumbnail-small">
                        <div class="video-title-small">3 Quick Crypto Tips You Need To Know</div>
                    </div>
                </td>
                <td>Mar 25, 2025</td>
                <td>5,432</td>
                <td>987</td>
                <td>124</td>
                <td>8.7%</td>
            </tr>
            <tr>
                <td>
                    <div class="video-title-cell">
                        <img src="/static/images/placeholder_vertical.jpg" alt="Video 2" class="video-thumbnail-small">
                        <div class="video-title-small">This Investment Hack Will Surprise You</div>
                    </div>
                </td>
                <td>Mar 20, 2025</td>
                <td>4,897</td>
                <td>856</td>
                <td>105</td>
                <td>7.9%</td>
            </tr>
            <tr>
                <td>
                    <div class="video-title-cell">
                        <img src="/static/images/placeholder_vertical.jpg" alt="Video 3" class="video-thumbnail-small">
                        <div class="video-title-small">How To Double Your Savings Fast</div>
                    </div>
                </td>
                <td>Mar 15, 2025</td>
                <td>3,945</td>
                <td>712</td>
                <td>97</td>
                <td>6.8%</td>
            </tr>
            <tr>
                <td>
                    <div class="video-title-cell">
                        <img src="/static/images/placeholder_vertical.jpg" alt="Video 4" class="video-thumbnail-small">
                        <div class="video-title-small">Secret Finance Trick Nobody Tells You</div>
                    </div>
                </td>
                <td>Mar 10, 2025</td>
                <td>3,621</td>
                <td>645</td>
                <td>85</td>
                <td>6.2%</td>
            </tr>
            <tr>
                <td>
                    <div class="video-title-cell">
                        <img src="/static/images/placeholder_vertical.jpg" alt="Video 5" class="video-thumbnail-small">
                        <div class="video-title-small">Try This Money Saving Method Today</div>
                    </div>
                </td>
                <td>Mar 5, 2025</td>
                <td>2,984</td>
                <td>523</td>
                <td>72</td>
                <td>5.8%</td>
            </tr>
          `;
        }

        // Top Videos Table - Real Data
        function createTopVideosTableWithData(topVideos) {
          if (!topVideos || !topVideos.length) {
            console.log("No top videos data available");
            createTopVideosTable(); // Fall back to sample data
            return;
          }

          const tableBody = document.getElementById("top-videos-body");
          tableBody.innerHTML = "";

          topVideos.forEach(video => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>
                  <div class="video-title-cell">
                      <img src="${video.thumbnail || '/static/images/placeholder_vertical.jpg'}" 
                           alt="${video.title}" class="video-thumbnail-small"
                           onerror="this.onerror=null; this.src='/static/images/placeholder_vertical.jpg';">
                      <div class="video-title-small">${video.title}</div>
                  </div>
              </td>
              <td>${formatDate(video.publish_date)}</td>
              <td>${formatNumber(video.views)}</td>
              <td>${formatNumber(video.likes)}</td>
              <td>${formatNumber(video.comments)}</td>
              <td>${video.ctr || "0%"}</td>
            `;
            tableBody.appendChild(row);
          });
        }

        // Create insights - Sample Data
        function createInsights() {
          document.getElementById("insights-container").innerHTML = `
            <div class="insight-card">
                <div class="insight-icon"><i class="fas fa-chart-line"></i></div>
                <div class="insight-content">
                    <div class="insight-title">Strong Growth Trend</div>
                    <div class="insight-description">Your channel is experiencing consistent growth with a 27% increase in views over the past 30 days. Continue creating content around your top-performing topics to maintain this momentum.</div>
                </div>
            </div>
            
            <div class="insight-card">
                <div class="insight-icon"><i class="fas fa-lightbulb"></i></div>
                <div class="insight-content">
                    <div class="insight-title">Content Opportunity</div>
                    <div class="insight-description">Your "Crypto Tips" shorts are generating 35% higher engagement than other topics. Consider creating more content in this category to capitalize on audience interest.</div>
                </div>
            </div>
            
            <div class="insight-card">
                <div class="insight-icon"><i class="fas fa-clock"></i></div>
                <div class="insight-content">
                    <div class="insight-title">Optimal Posting Times</div>
                    <div class="insight-description">Shorts posted on Saturdays between 6-9 PM are performing 42% better than other times. Adjust your publishing schedule to maximize reach and engagement.</div>
                </div>
            </div>
            
            <div class="insight-card">
                <div class="insight-icon"><i class="fas fa-users"></i></div>
                <div class="insight-content">
                    <div class="insight-title">Audience Insight</div>
                    <div class="insight-description">Your content is resonating strongly with the 25-34 age group. Consider tailoring future content to address the specific financial interests and needs of this demographic.</div>
                </div>
            </div>
          `;
        }

        // Create insights - Real Data
        function createInsightsWithData(insights) {
          // If no insights provided, generate them based on other data
          if (!insights || !insights.length) {
            createInsights(); // Use sample insights
            return;
          }

          const container = document.getElementById("insights-container");
          container.innerHTML = "";

          insights.forEach(insight => {
            const card = document.createElement("div");
            card.className = "insight-card";
            card.innerHTML = `
              <div class="insight-icon"><i class="fas fa-${insight.icon || 'lightbulb'}"></i></div>
              <div class="insight-content">
                  <div class="insight-title">${insight.title}</div>
                  <div class="insight-description">${insight.description}</div>
              </div>
            `;
            container.appendChild(card);
          });
        }

        // Engagement Chart - Sample Data
        function createEngagementChart() {
          const ctx = document.createElement("canvas");
          document.getElementById("engagement-chart").innerHTML = "";
          document.getElementById("engagement-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: ["Likes", "Comments", "Shares", "Saves", "Subscribes"],
              datasets: [
                {
                  label: "Count",
                  data: [2891, 584, 326, 198, 147],
                  backgroundColor: [
                    "rgba(54, 162, 235, 0.7)",
                    "rgba(255, 99, 132, 0.7)",
                    "rgba(75, 192, 192, 0.7)",
                    "rgba(255, 206, 86, 0.7)",
                    "rgba(153, 102, 255, 0.7)",
                  ],
                  borderColor: [
                    "rgba(54, 162, 235, 1)",
                    "rgba(255, 99, 132, 1)",
                    "rgba(75, 192, 192, 1)",
                    "rgba(255, 206, 86, 1)",
                    "rgba(153, 102, 255, 1)",
                  ],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
        }

        // Engagement Chart - Real Data
        function createEngagementChartWithData(engagementData) {
          if (!engagementData) {
            console.log("No engagement data available");
            createEngagementChart(); // Fall back to sample data
            return;
          }

          const ctx = document.createElement("canvas");
          document.getElementById("engagement-chart").innerHTML = "";
          document.getElementById("engagement-chart").appendChild(ctx);

          const labels = Object.keys(engagementData);
          const values = Object.values(engagementData);

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: labels.map(label => label.charAt(0).toUpperCase() + label.slice(1)),
              datasets: [
                {
                  label: "Count",
                  data: values,
                  backgroundColor: [
                    "rgba(54, 162, 235, 0.7)",
                    "rgba(255, 99, 132, 0.7)",
                    "rgba(75, 192, 192, 0.7)",
                    "rgba(255, 206, 86, 0.7)",
                    "rgba(153, 102, 255, 0.7)",
                  ],
                  borderColor: [
                    "rgba(54, 162, 235, 1)",
                    "rgba(255, 99, 132, 1)",
                    "rgba(75, 192, 192, 1)",
                    "rgba(255, 206, 86, 1)",
                    "rgba(153, 102, 255, 1)",
                  ],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
        }

        // Sources Chart - Sample Data
        function createSourcesChart() {
          const ctx = document.createElement("canvas");
          document.getElementById("sources-chart").innerHTML = "";
          document.getElementById("sources-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: [
                "Shorts Feed",
                "Channel Page",
                "Search",
                "External",
                "Suggested",
              ],
              datasets: [
                {
                  data: [65, 12, 8, 10, 5],
                  backgroundColor: [
                    "rgba(255, 99, 132, 0.7)",
                    "rgba(54, 162, 235, 0.7)",
                    "rgba(255, 206, 86, 0.7)",
                    "rgba(75, 192, 192, 0.7)",
                    "rgba(153, 102, 255, 0.7)",
                  ],
                  borderColor: [
                    "rgba(255, 99, 132, 1)",
                    "rgba(54, 162, 235, 1)",
                    "rgba(255, 206, 86, 1)",
                    "rgba(75, 192, 192, 1)",
                    "rgba(153, 102, 255, 1)",
                  ],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "right",
                },
              },
            },
          });
        }

        // Sources Chart - Real Data
        function createSourcesChartWithData(deviceData) {
          if (!deviceData || !deviceData.devices || !deviceData.percentages) {
            console.log("No device data available");
            createSourcesChart(); // Fall back to sample data
            return;
          }

          const ctx = document.createElement("canvas");
          document.getElementById("sources-chart").innerHTML = "";
          document.getElementById("sources-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: deviceData.devices,
              datasets: [
                {
                  data: deviceData.percentages,
                  backgroundColor: [
                    "rgba(255, 99, 132, 0.7)",
                    "rgba(54, 162, 235, 0.7)",
                    "rgba(255, 206, 86, 0.7)",
                    "rgba(75, 192, 192, 0.7)",
                    "rgba(153, 102, 255, 0.7)",
                  ],
                  borderColor: [
                    "rgba(255, 99, 132, 1)",
                    "rgba(54, 162, 235, 1)",
                    "rgba(255, 206, 86, 1)",
                    "rgba(75, 192, 192, 1)",
                    "rgba(153, 102, 255, 1)",
                  ],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "right",
                },
              },
            },
          });
        }

        // Demographics Chart - Sample Data
        function createDemographicsChart() {
          const ctx = document.createElement("canvas");
          document.getElementById("demographics-chart").innerHTML = "";
          document.getElementById("demographics-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: ["18-24", "25-34", "35-44", "45-54", "55-64", "65+"],
              datasets: [
                {
                  label: "Male",
                  data: [28, 35, 15, 8, 4, 2],
                  backgroundColor: "rgba(54, 162, 235, 0.7)",
                  borderColor: "rgba(54, 162, 235, 1)",
                  borderWidth: 1,
                },
                {
                  label: "Female",
                  data: [25, 32, 18, 10, 3, 1],
                  backgroundColor: "rgba(255, 99, 132, 0.7)",
                  borderColor: "rgba(255, 99, 132, 1)",
                  borderWidth: 1,
                },
                {
                  label: "Other",
                  data: [5, 8, 3, 2, 1, 0],
                  backgroundColor: "rgba(75, 192, 192, 0.7)",
                  borderColor: "rgba(75, 192, 192, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "top",
                },
              },
              scales: {
                x: {
                  stacked: true,
                },
                y: {
                  stacked: true,
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return value + "%";
                    },
                  },
                },
              },
            },
          });
        }

        // Demographics Chart - Real Data
        function createDemographicsChartWithData(demographicsData) {
          if (!demographicsData || !demographicsData.age_groups) {
            console.log("No demographics data available");
            createDemographicsChart(); // Fall back to sample data
            return;
          }

          const ctx = document.createElement("canvas");
          document.getElementById("demographics-chart").innerHTML = "";
          document.getElementById("demographics-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: demographicsData.age_groups,
              datasets: [
                {
                  label: "Male",
                  data: demographicsData.male,
                  backgroundColor: "rgba(54, 162, 235, 0.7)",
                  borderColor: "rgba(54, 162, 235, 1)",
                  borderWidth: 1,
                },
                {
                  label: "Female",
                  data: demographicsData.female,
                  backgroundColor: "rgba(255, 99, 132, 0.7)",
                  borderColor: "rgba(255, 99, 132, 1)",
                  borderWidth: 1,
                },
                {
                  label: "Other",
                  data: demographicsData.other,
                  backgroundColor: "rgba(75, 192, 192, 0.7)",
                  borderColor: "rgba(75, 192, 192, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "top",
                },
              },
              scales: {
                x: {
                  stacked: true,
                },
                y: {
                  stacked: true,
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return value + "%";
                    },
                  },
                },
              },
            },
          });
        }

        // Geography Chart - Sample Data
        function createGeographyChart() {
          const ctx = document.createElement("canvas");
          document.getElementById("geography-chart").innerHTML = "";
          document.getElementById("geography-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: [
                "United States",
                "India",
                "United Kingdom",
                "Canada",
                "Australia",
                "Germany",
                "Other",
              ],
              datasets: [
                {
                  label: "Views Percentage",
                  data: [45, 18, 12, 8, 5, 4, 8],
                  backgroundColor: "rgba(54, 162, 235, 0.7)",
                  borderColor: "rgba(54, 162, 235, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              indexAxis: "y",
              plugins: {
                legend: {
                  display: false,
                },
              },
              scales: {
                x: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return value + "%";
                    },
                  },
                },
              },
            },
          });
        }

        // Geography Chart - Real Data
        function createGeographyChartWithData(geographicData) {
          if (!geographicData || !geographicData.countries || !geographicData.percentages) {
            console.log("No geographic data available");
            createGeographyChart(); // Fall back to sample data
            return;
          }

          const ctx = document.createElement("canvas");
          document.getElementById("geography-chart").innerHTML = "";
          document.getElementById("geography-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: geographicData.countries,
              datasets: [
                {
                  label: "Views Percentage",
                  data: geographicData.percentages,
                  backgroundColor: "rgba(54, 162, 235, 0.7)",
                  borderColor: "rgba(54, 162, 235, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              indexAxis: "y",
              plugins: {
                legend: {
                  display: false,
                },
              },
              scales: {
                x: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return value + "%";
                    },
                  },
                },
              },
            },
          });
        }

        // Device Chart - Sample Data
        function createDeviceChart() {
          const ctx = document.createElement("canvas");
          document.getElementById("device-chart").innerHTML = "";
          document.getElementById("device-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: ["Mobile", "Tablet", "Desktop", "TV", "Other"],
              datasets: [
                {
                  data: [78, 8, 12, 1, 1],
                  backgroundColor: [
                    "rgba(255, 99, 132, 0.7)",
                    "rgba(54, 162, 235, 0.7)",
                    "rgba(255, 206, 86, 0.7)",
                    "rgba(75, 192, 192, 0.7)",
                    "rgba(153, 102, 255, 0.7)",
                  ],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "right",
                },
              },
            },
          });
        }

        // Device Chart - Real Data
        function createDeviceChartWithData(deviceData) {
          if (!deviceData || !deviceData.devices || !deviceData.percentages) {
            console.log("No device data available");
            createDeviceChart(); // Fall back to sample data
            return;
          }

          const ctx = document.createElement("canvas");
          document.getElementById("device-chart").innerHTML = "";
          document.getElementById("device-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: deviceData.devices,
              datasets: [
                {
                  data: deviceData.percentages,
                  backgroundColor: [
                    "rgba(255, 99, 132, 0.7)",
                    "rgba(54, 162, 235, 0.7)",
                    "rgba(255, 206, 86, 0.7)",
                    "rgba(75, 192, 192, 0.7)",
                    "rgba(153, 102, 255, 0.7)",
                  ],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "right",
                },
              },
            },
          });
        }

        // Performance Chart - Sample Data
        function createPerformanceChart() {
          const ctx = document.createElement("canvas");
          document.getElementById("performance-chart").innerHTML = "";
          document.getElementById("performance-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "line",
            data: {
              labels: [
                "Video 1",
                "Video 2",
                "Video 3",
                "Video 4",
                "Video 5",
                "Video 6",
                "Video 7",
                "Video 8",
              ],
              datasets: [
                {
                  label: "Views",
                  data: [1205, 2398, 1845, 3120, 4532, 3987, 5120, 4876],
                  borderColor: "#FF0000",
                  backgroundColor: "rgba(255, 0, 0, 0.1)",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y",
                },
                {
                  label: "Engagement Rate",
                  data: [8.2, 9.5, 7.8, 8.4, 12.3, 9.8, 11.2, 10.5],
                  borderColor: "#4CAF50",
                  backgroundColor: "rgba(76, 175, 80, 0.1)",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y1",
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: {
                mode: "index",
                intersect: false,
              },
              plugins: {
                legend: {
                  position: "top",
                },
              },
              scales: {
                y: {
                  type: "linear",
                  display: true,
                  position: "left",
                  title: {
                    display: true,
                    text: "Views",
                  },
                },
                y1: {
                  type: "linear",
                  display: true,
                  position: "right",
                  title: {
                    display: true,
                    text: "Engagement Rate (%)",
                  },
                  grid: {
                    drawOnChartArea: false,
                  },
                  ticks: {
                    callback: function (value) {
                      return value + "%";
                    },
                  },
                },
              },
            },
          });
        }

        // Performance Chart - Real Data
        function createPerformanceChartWithData(performanceData) {
          if (!performanceData || !performanceData.videos || !performanceData.views || !performanceData.engagement_rates) {
            console.log("No performance data available");
            createPerformanceChart(); // Fall back to sample data
            return;
          }

          const ctx = document.createElement("canvas");
          document.getElementById("performance-chart").innerHTML = "";
          document.getElementById("performance-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "line",
            data: {
              labels: performanceData.videos,
              datasets: [
                {
                  label: "Views",
                  data: performanceData.views,
                  borderColor: "#FF0000",
                  backgroundColor: "rgba(255, 0, 0, 0.1)",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y",
                },
                {
                  label: "Engagement Rate",
                  data: performanceData.engagement_rates,
                  borderColor: "#4CAF50",
                  backgroundColor: "rgba(76, 175, 80, 0.1)",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y1",
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: {
                mode: "index",
                intersect: false,
              },
              plugins: {
                legend: {
                  position: "top",
                },
              },
              scales: {
                y: {
                  type: "linear",
                  display: true,
                  position: "left",
                  title: {
                    display: true,
                    text: "Views",
                  },
                },
                y1: {
                  type: "linear",
                  display: true,
                  position: "right",
                  title: {
                    display: true,
                    text: "Engagement Rate (%)",
                  },
                  grid: {
                    drawOnChartArea: false,
                  },
                  ticks: {
                    callback: function (value) {
                      return value + "%";
                    },
                  },
                },
              },
            },
          });
        }

        // Topics Chart - Sample Data
        function createTopicsChart() {
          const ctx = document.createElement("canvas");
          document.getElementById("topics-chart").innerHTML = "";
          document.getElementById("topics-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: [
                "Finance Tips",
                "Crypto Updates",
                "Tech Hacks",
                "Investment Strategies",
                "Trading Advice",
                "Passive Income",
                "Personal Finance",
              ],
              datasets: [
                {
                  label: "Average Views",
                  data: [4200, 3950, 3450, 3200, 2900, 2700, 2500],
                  backgroundColor: "rgba(255, 99, 132, 0.7)",
                  borderColor: "rgba(255, 99, 132, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              indexAxis: "y",
              plugins: {
                legend: {
                  display: false,
                },
              },
              scales: {
                x: {
                  beginAtZero: true,
                },
              },
            },
          });
        }

        // Publishing Chart - Sample Data
        function createPublishingChart() {
          const ctx = document.createElement("canvas");
          document.getElementById("publishing-chart").innerHTML = "";
          document.getElementById("publishing-chart").appendChild(ctx);

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
              datasets: [
                {
                  label: "Morning (6-11 AM)",
                  data: [2800, 2900, 3100, 2950, 3200, 3500, 3100],
                  backgroundColor: "rgba(255, 206, 86, 0.7)",
                  borderColor: "rgba(255, 206, 86, 1)",
                  borderWidth: 1,
                },
                {
                  label: "Afternoon (12-5 PM)",
                  data: [3200, 3150, 3300, 3250, 3500, 3800, 3450],
                  backgroundColor: "rgba(54, 162, 235, 0.7)",
                  borderColor: "rgba(54, 162, 235, 1)",
                  borderWidth: 1,
                },
                {
                  label: "Evening (6-11 PM)",
                  data: [3900, 3850, 4100, 4000, 4600, 4800, 4200],
                  backgroundColor: "rgba(255, 99, 132, 0.7)",
                  borderColor: "rgba(255, 99, 132, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "top",
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: "Average Views",
                  },
                },
              },
            },
          });
        }

        // ====== UTILITY FUNCTIONS ======

        // Format number with commas
        function formatNumber(num) {
          return new Intl.NumberFormat().format(num);
        }

        // Format compact number (e.g., 1200 -> 1.2K)
        function formatCompactNumber(num) {
          if (num >= 1000000) {
            return (num / 1000000).toFixed(1) + "M";
          } else if (num >= 1000) {
            return (num / 1000).toFixed(1) + "K";
          }
          return num;
        }

        // Format time (seconds to MM:SS)
        function formatTime(seconds) {
          if (!seconds) return "0:00";
          seconds = Math.round(seconds);
          const minutes = Math.floor(seconds / 60);
          const remainingSeconds = seconds % 60;
          return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Format ISO date to readable format
        function formatDate(isoDate) {
          if (!isoDate) return "";
          
          try {
            const date = new Date(isoDate);
            return date.toLocaleString('en-US', { 
              year: 'numeric', 
              month: 'short', 
              day: 'numeric' 
            });
          } catch (error) {
            return isoDate;
          }
        }

        // Toast notification function
        function showToast(type, title, message, duration = 5000) {
          const toastContainer = document.getElementById("toast-container");

          if (!toastContainer) {
            const container = document.createElement("div");
            container.id = "toast-container";
            container.className = "toast-container";
            document.body.appendChild(container);
          }

          const toast = document.createElement("div");
          toast.className = `toast toast-${type}`;

          let iconClass = "fas fa-info-circle";
          if (type === "success") iconClass = "fas fa-check-circle";
          if (type === "error") iconClass = "fas fa-exclamation-circle";
          if (type === "warning") iconClass = "fas fa-exclamation-triangle";

          toast.innerHTML = `
            <div class="toast-icon"><i class="${iconClass}"></i></div>
            <div class="toast-content">
                <div class="toast-title">${title}</div>
                <div class="toast-message">${message}</div>
            </div>
            <div class="toast-close"><i class="fas fa-times"></i></div>
          `;

          document.getElementById("toast-container").appendChild(toast);

          // Add click event to close button
          toast.querySelector(".toast-close").addEventListener("click", () => {
            toast.style.animation = "slide-out 0.3s forwards";
            setTimeout(() => {
              toast.remove();
            }, 300);
          });

          // Auto remove after duration
          setTimeout(() => {
            if (toast.parentNode) {
              toast.style.animation = "slide-out 0.3s forwards";
              setTimeout(() => {
                if (toast.parentNode) toast.remove();
              }, 300);
            }
          }, duration);
        }

        // Load initial data
        setTimeout(() => {
          const useRealData = localStorage.getItem("useRealData") === "true";
          loadAllData(useRealData);
        }, 500);
      });
    </script>
  </body>
</html>